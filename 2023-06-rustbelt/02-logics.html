<!DOCTYPE HTML>
<html lang="zh" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>（一）形式化逻辑基础 - Rust中文博客</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../overview.html">序言</a></li><li class="chapter-item expanded affix "><li class="part-title">2023-06</li><li class="chapter-item expanded "><a href="../2023-06-rustbelt/00.html">RustBelt——Rust语言的形式化语义模型</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../2023-06-rustbelt/01-background.html">（零）背景</a></li><li class="chapter-item expanded "><a href="../2023-06-rustbelt/02-logics.html" class="active">（一）形式化逻辑基础</a></li><li class="chapter-item expanded "><a href="../2023-06-rustbelt/03-rust-semantics.html">（二）Rust语义模型</a></li><li class="chapter-item expanded "><a href="../2023-06-rustbelt/04-rc.html">（三）示例Rc</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">2022-01</li><li class="chapter-item expanded "><a href="../2022-01-polonius/00.html">Polonius学习笔记</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../2022-01-polonius/01-21-借用检查（零）-原子式与输入.html">（零）原子式与输入</a></li><li class="chapter-item expanded "><a href="../2022-01-polonius/01-21-借用检查（一）-初始化分析.html">（一）初始化分析</a></li><li class="chapter-item expanded "><a href="../2022-01-polonius/01-23-借用检查（二）-存活性分析.html">（二）存活性分析</a></li><li class="chapter-item expanded "><a href="../2022-01-polonius/02-08-借用检查（三）-借债分析.html">（三）借债分析</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../2022-01-polonius/02-08-借用检查（三）-借债分析-原始规则.html">(1) 原始规则</a></li><li class="chapter-item expanded "><a href="../2022-01-polonius/02-19-借用检查（三）-借债分析-位置无关规则.html">(2) 位置无关规则</a></li><li class="chapter-item expanded "><div>(3) 优化规则</div></li></ol></li></ol></li><li class="chapter-item expanded "><li class="part-title">2021-09</li><li class="chapter-item expanded "><a href="../2021-09-ghost-cell/09-03-ghost-cell.html">Ghost Cell试用体验</a></li><li class="chapter-item expanded affix "><li class="part-title">2021-01</li><li class="chapter-item expanded "><a href="../2021-01-proc-macro/00.html">Rust过程宏入门系列</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../2021-01-proc-macro/01-06-过程宏（一）-过程宏简介.html">（一）过程宏简介</a></li><li class="chapter-item expanded "><a href="../2021-01-proc-macro/01-07-过程宏（二）-初探派生宏.html">（二）初探派生宏</a></li><li class="chapter-item expanded "><a href="../2021-01-proc-macro/01-10-过程宏（三）-实现简易派生宏.html">（三）实现简易派生宏</a></li><li class="chapter-item expanded "><a href="../2021-01-proc-macro/01-16-过程宏（四）-遍历结构体字段.html">（四）遍历结构体字段</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust中文博客</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/frank-king/rustblog-zh" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="形式化逻辑基础"><a class="header" href="#形式化逻辑基础">形式化逻辑基础</a></h1>
<p>下面将介绍形式化逻辑中常用的两个基础概念．</p>
<h2 id="霍尔逻辑hoare-logic"><a class="header" href="#霍尔逻辑hoare-logic">霍尔逻辑（Hoare Logic）</a></h2>
<p><img src="images/hoare.png" alt="Hoare Logic" /></p>
<p><a href="https://en.wikipedia.org/wiki/Hoare_logic">霍尔逻辑</a>中的命题\( \lbrace P \rbrace \; C \; \lbrace Q \rbrace \)是指，
对于某一段程序\( C \)，在前置条件\( P \)成立的情况下，若正常执行并停机，那么应当满足后置条件\( Q \)．</p>
<p>霍尔逻辑与程序开发过程中的单元测试的概念类似．
若以单元测试来类比，程序\( C \)相当于单元测试中的被测函数；
前置条件\( P \)相当于单元测试中的输入参数；后置条件\( Q \)相当于单元测试中的断言．</p>
<p><img src="images/hoare-example.png" alt="Hoare Logic Examples" /></p>
<p>霍尔逻辑示例:</p>
<ul>
<li>\[ \lbrace \mathsf{True} \rbrace \; \mathbf{let} \, x = 10 \; \lbrace x = 10 \rbrace \]
表示程序\( \; \mathbf{let} \, x = 10 \)无需任何前置条件，在运行结束后得到后置条件\( x = 10 \)．</li>
<li>\[ \lbrace x = 3 \rbrace \; x \,+\!= 1 \; \lbrace x = 4 \rbrace \]
表示程序\( x \, + \! = 1 \) 在\( x = 3 \)的前置条件下，运行结束后会得到后置条件\( x = 4 \)．</li>
<li>\[ \lbrace \mathsf{True} \rbrace \; \mathbf{loop} \, \lbrace \! \rbrace \; \lbrace \mathsf{False} \rbrace \]
表示程序\( \mathbf{loop} \, \lbrace \! \rbrace \)无需任何前置条件，但永不停机（假设它真的停机了，那么会得到一个假命题
\( \mathsf{False} \)即为其后置条件）．</li>
</ul>
<h2 id="分离逻辑separation-logic-iris"><a class="header" href="#分离逻辑separation-logic-iris">分离逻辑（Separation Logic (Iris)）</a></h2>
<p><img src="images/sep-logic.png" alt="Separation Logic" /></p>
<p><a href="https://en.wikipedia.org/wiki/Separation_logic">分离逻辑</a>可看作霍尔逻辑的扩展，用以表达内存中<strong>独占</strong>（Ownership）与
<strong>不交</strong>（Disjointness）的两个性质．</p>
<h3 id="ownership"><a class="header" href="#ownership">Ownership</a></h3>
<p>命题\( x \mapsto v \)表示内存地址\( x \)唯一地指向了值\( v \)．</p>
<h3 id="disjointness"><a class="header" href="#disjointness">Disjointness</a></h3>
<p>命题\( P \ast Q \)表达了\( P \)与\( Q \)在内存空间上不相交．例如给定\( (x \mapsto v) \ast (y \mapsto w) \)，
则知\( x \ne y \)，因为\( x \)与\( y \)不能指代同一内存地址（not alias）．</p>
<p><img src="images/sep-logic-explanations.png" alt="Separation Logic Explanations" /></p>
<p>\( \ast \)与\( \land \)的区别:</p>
<ul>
<li>\[ (x \mapsto v) \land (x \mapsto w) \implies v = w \]
资源是唯一的，因此仅存在唯一的值\(v\)使得\(x \mapsto v\)．</li>
<li>\[ (x \mapsto v) \ast (x \mapsto v) \implies \mathsf{False} \]
资源是不可复制的，因此即使是同一个值\(v\)，也不能同时存在两份相同的资源\(x \mapsto v\)．</li>
<li>\[ (x = 1) \ast (y = 2) \iff (x = 1) \land (y = 2) \]
对于<strong>非资源</strong>或者<a href="#%E6%B0%B8%E4%B9%85%E8%B5%84%E6%BA%90persistent"><strong>永久资源</strong></a>，\( \ast \)与\( \land \)是等价的．</li>
</ul>
<h3 id="magic-wand"><a class="header" href="#magic-wand">Magic Wand</a></h3>
<p>命题\( P -\!\ast\, Q \)表示若消耗掉资源\( P \)则可获得资源\( Q \)．它与逻辑命题中「蕴含（Implies，\( \Rightarrow \)）」
的概念较为相似，如\( P \ast (P -\! \ast \, Q) \vdash Q \)之于\( P \land (P \Rightarrow Q) \vdash Q \)．</p>
<p>注意此处的资源\(P\)不必包含在资源\(Q\)中．</p>
<h3 id="accessor资源访问模式经大幅简化"><a class="header" href="#accessor资源访问模式经大幅简化">Accessor资源访问模式（经大幅简化）*</a></h3>
<p><img src="images/accessor.png" alt="Accessor" /></p>
<p>命题\( Q \propto P \, \mathrel{\mathop:}= \, Q -\!\ast\, \big( P \ast (P -\!\ast\, Q) \big)\)表示：在较大的资源\(Q\)中，
可以临时取出包含于\(Q\)的较小资源\(P\)，待\(P\)使用结束后，归还\(P\)则可重新获得原资源\(Q\)．</p>
<p>通常，资源\(Q\)都完全包含资源\(P\)．Accessor是一种访问资源的模式，当某一较大资源不便于直接拆分为两个较小的资源以\(\ast\)相连的形式时，
比较适合使用Accessor模式．</p>
<h3 id="永久资源persistent"><a class="header" href="#永久资源persistent">永久资源（Persistent）*</a></h3>
<p><img src="images/persistent.png" alt="Persistent" /></p>
<p>命题\( P \; \mathsf{Persistent} \, \mathrel{\mathop:}= \, P -\!\ast\, P \ast P \)表示资源\(P\)永不耗尽，可任意复制．永久资源又称
<strong>知识（Knowledge)</strong> 或<strong>信息（Information)</strong>．如\(1 + 1 = 2\)，\( x = 1 \implies x + 1 = 2 \)，
\( \lbrace \mathsf{True} \rbrace \; \mathbf{let} \, x = 10 \; \lbrace x = 10 \rbrace \) 等．注意霍尔逻辑作为复合命题，也属于永久资源．</p>
<hr />
<p><img src="images/sep-logic-examples.png" alt="Separation Logic Examples" /></p>
<p>分离逻辑的示例:</p>
<ul>
<li>\[ \lbrace \mathsf{True} \rbrace \; \mathbf{let} \, x = \text{Box::new}(1) \; \lbrace x \mapsto 1 \rbrace \]
表示程序\( x = \textrm{Box::new}(1) \)无需任何前置条件，在运行结束后获得资源\( x \mapsto 1 \)<sup class="footnote-reference"><a href="#dealloc">1</a></sup>．这里\( \mapsto \)的独占语义
与Rust中<code>Box</code>类型的语义一致．</li>
<li>\[ \big\lbrace (x \mapsto 1) \ast (y \mapsto 1) \big\rbrace \; {\mbox*} x \,+\!= {\mbox*} y \; 
\big\lbrace (x \mapsto 2) \ast (y \mapsto 1) \big\rbrace \]
表示程序\( {\mbox*} x \,+\!= {\mbox*} y \)在前置条件\( \big\lbrace (x \mapsto 1) \ast (y \mapsto 1) \big\rbrace \)下，
运行结束后将得到\( \big\lbrace (x \mapsto 2) \ast (y \mapsto 1) \big\rbrace \)．注意 \( (x \mapsto 1) \ast (y \mapsto 1) \) 
表明\(x\)与\(y\)的地址不可能相同，与Rust代码
<pre><code class="language-rust ignore">fn add(x: &amp;mut i32, y: &amp;i32) {
    *x += *y;
}
</code></pre>
的语义一致．</li>
<li>\[ \lbrace x \mapsto - \rbrace \; \text{drop}(x) \; \lbrace \mathsf{True} \rbrace \]
表示程序\( \text{drop}(x) \)在\( \lbrace x \mapsto - \rbrace \)的前置条件下，运行结束后将消耗掉该资源．其中\( \lbrace x \mapsto - 
\rbrace \)表示不关心地址\(x\)具体指向什么值．</li>
</ul>
<div class="footnote-definition" id="dealloc"><sup class="footnote-definition-label">1</sup>
<p>此处省略了内存释放的部分．</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../2023-06-rustbelt/01-background.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../2023-06-rustbelt/03-rust-semantics.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../2023-06-rustbelt/01-background.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../2023-06-rustbelt/03-rust-semantics.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script src="https://utteranc.es/client.js"
                repo="frank-king/rustblog-zh"
                issue-term="title"
                theme="github-dark"
                crossorigin="anonymous"
                async>
        </script>

    </body>
</html>
